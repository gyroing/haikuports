SUMMARY="Piper TTS is an offline text-to-speech program using the NCNN library"
DESCRIPTION="Piper TTS is an offline text-to-speech program using the NCNN library \
	to provide natural, Human-like voices. Different voice models can be downloaded from \
	https://huggingface.co/gyroing/PiperTTS-NCNN-Models/tree/main."
HOMEPAGE="https://github.com/gyroing/PiperTTS-HaikuOS/"
COPYRIGHT="2025 GYROING"
LICENSE="BSD (3-clause)"
ARCHITECTURES="x86_64"
REVISION="1"
RECIPE_API_VERSION="2"
SOURCE_URI="https://github.com/gyroing/PiperTTS-HaikuOS/archive/refs/tags/piper.tar.gz"
CHECKSUM_SHA256="7d391de5f9664d0e05e357bb206ec827dc5c0b6cee3002e03134d778dc37066f"
srcGitRev="d7df277"
SOURCE_URI_2="https://github.com/Tencent/ncnn/archive/${srcGitRev}.tar.gz"
CHECKSUM_SHA256_2="989bb0f7b8a00c24b3b297cdc7f23c6932a5676731c7dda24ea29dfc8eae4668"
SOURCE_DIR="PiperTTS-HaikuOS-piper"
PROVIDES="
	pipertts = $portVersion
	cmd:pipertts = $portVersion
	"
BUILD_REQUIRES="
	haiku_devel
	cmd:cmake
	cmd:gcc
	cmd:make
	cmd:git
	"
REQUIRES="
	haiku
	cmd:espeak
	"
NCNN_INSTALL_DIR="$buildDir/ncnn-install"
BUILD()
{
	cd ../../sources-2/ncnn-d7df277f9cc15a00b19877ab75b287ade42a22ab
	mkdir -p build
	cd build
	cmake -DCMAKE_BUILD_TYPE=Release \
		-DNCNN_VULKAN=OFF \
		-DNCNN_BUILD_EXAMPLES=OFF -DNCNN_BUILD_BENCHMARK=OFF \
		-DNCNN_PYTHON=OFF \
		-DNCNN_BUILD_TESTS=OFF \
		-DNCNN_BUILD_TOOLS=OFF \
		-DCMAKE_INSTALL_PREFIX=$NCNN_INSTALL_DIR ..
	make -j$(nproc)
	make install
	cd ../../../

	cd sources/PiperTTS-HaikuOS-piper
	g++ pipertts.cpp piper_ncnn_impl.cpp \
		-o pipertts -lbe -lmedia -fopenmp \
		-lncnn -I$NCNN_INSTALL_DIR/include/ncnn \
		-L$NCNN_INSTALL_DIR/lib
}
INSTALL()
{
	mkdir -p $binDir
	cp pipertts $binDir/
}
