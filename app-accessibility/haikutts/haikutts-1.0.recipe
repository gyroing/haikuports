SUMMARY="Offline TTS with NCNN backend (Piper TTS)"
DESCRIPTION="A simple offline TTS program using NCNN library"
HOMEPAGE="https://github.com/gyroing/HaikuTTS"
COPYRIGHT="2025 GYROING"
LICENSE="BSD (3-clause)"
ARCHITECTURES="x86_64"
REVISION="1"
RECIPE_API_VERSION="2"
SOURCE_URI="https://github.com/gyroing/HaikuTTS/archive/refs/tags/haikutts-haikuports.tar.gz"
CHECKSUM_SHA256="9aa26b38d74969bfb4676bb91aa45132ac83b064e27351aff082fb6483b646a7"
SOURCE_URI_2="https://github.com/gyroing/ncnn/archive/refs/tags/ncnn-haikuports.tar.gz"
CHECKSUM_SHA256_2="26c8028fc1716ef9c68f7b6ffccb4e6e5e3434478ce0974c42f154a65a5d51ef"
SOURCE_DIR="HaikuTTS-haikutts-haikuports"
PROVIDES="
	haikutts = $portVersion
	cmd:haikutts = $portVersion
	"
BUILD_REQUIRES="
	haiku_devel
	cmd:cmake
	cmd:gcc
	cmd:make
	cmd:git
	"
REQUIRES="
	haiku
	cmd:espeak
	"
NCNN_INSTALL_DIR="$buildDir/ncnn-install"
BUILD()
{
	cd ../../sources-2/ncnn-ncnn-haikuports
	mkdir -p build
	cd build
	cmake -DCMAKE_BUILD_TYPE=Release \
		-DNCNN_VULKAN=OFF \
		-DNCNN_BUILD_EXAMPLES=OFF -DNCNN_BUILD_BENCHMARK=OFF \
		-DNCNN_PYTHON=OFF \
		-DNCNN_BUILD_TESTS=OFF \
		-DNCNN_BUILD_TOOLS=OFF \
		-DCMAKE_INSTALL_PREFIX=$NCNN_INSTALL_DIR ..
	make -j$(nproc)
	make install
	cd ../../../

	cd sources/HaikuTTS-haikutts-haikuports
	g++ haikutts.cpp piper_ncnn_impl.cpp \
		-o haikutts -lbe -lmedia -fopenmp \
		-lncnn -I$NCNN_INSTALL_DIR/include/ncnn \
		-L$NCNN_INSTALL_DIR/lib
}
INSTALL()
{
	mkdir -p $binDir
	cp haikutts $binDir/
}
