SUMMARY="Piper TTS is an offline text-to-speech program using the NCNN library to provide natural, \
	human-like voices. Different voice models can be downloaded from \
	https://huggingface.co/gyroing/PiperTTS-NCNN-Models/tree/main."
DESCRIPTION="Offline TTS program using NCNN library With Natural Voice"
HOMEPAGE="https://github.com/gyroing/PiperTTS-HaikuOS/"
COPYRIGHT="2025 GYROING"
LICENSE="BSD (3-clause)"
ARCHITECTURES="x86_64"
REVISION="1"
RECIPE_API_VERSION="2"
SOURCE_URI="https://github.com/gyroing/PiperTTS-HaikuOS/archive/refs/tags/piper.tar.gz"
CHECKSUM_SHA256="b50256cde0232eb52895a124ce0620cc419fff78df203e0c0ad275e5a2d8b8d0"
srcGitRev="d7df277"
SOURCE_URI_2="https://github.com/Tencent/ncnn/archive/${srcGitRev}.tar.gz"
CHECKSUM_SHA256_2="26c8028fc1716ef9c68f7b6ffccb4e6e5e3434478ce0974c42f154a65a5d51ef"
SOURCE_DIR="PiperTTS-HaikuOS-piper"
PROVIDES="
	haikutts = $portVersion
	cmd:haikutts = $portVersion
	"
BUILD_REQUIRES="
	haiku_devel
	cmd:cmake
	cmd:gcc
	cmd:make
	cmd:git
	"
REQUIRES="
	haiku
	cmd:espeak
	"
NCNN_INSTALL_DIR="$buildDir/ncnn-install"
BUILD()
{
	cd ../../sources-2/ncnn-ncnn-haikuports
	mkdir -p build
	cd build
	cmake -DCMAKE_BUILD_TYPE=Release \
		-DNCNN_VULKAN=OFF \
		-DNCNN_BUILD_EXAMPLES=OFF -DNCNN_BUILD_BENCHMARK=OFF \
		-DNCNN_PYTHON=OFF \
		-DNCNN_BUILD_TESTS=OFF \
		-DNCNN_BUILD_TOOLS=OFF \
		-DCMAKE_INSTALL_PREFIX=$NCNN_INSTALL_DIR ..
	make -j$(nproc)
	make install
	cd ../../../

	cd sources/PiperTTS-HaikuOS-piper
	g++ piper.cpp piper_ncnn_impl.cpp \
		-o pipertts -lbe -lmedia -fopenmp \
		-lncnn -I$NCNN_INSTALL_DIR/include/ncnn \
		-L$NCNN_INSTALL_DIR/lib
}
INSTALL()
{
	mkdir -p $binDir
	cp haikutts $binDir/
}
